services:
  # Main application service
  clinical-trial-app:
    build: .
    container_name: clinical-trial-analysis-app
    ports:
      - "8501:8501"  # Streamlit dashboard
    volumes:
      - ./logs:/app/logs
      - ./cache:/app/cache
      - ./reports:/app/reports
      - ./clinical_trials.db:/app/clinical_trials.db
      - ./config.json:/app/config.json
    environment:
      - PYTHONPATH=/app

  # Data ingestion service (can be run manually or scheduled)
  data-ingestion:
    build: .
    container_name: clinical-trial-data-ingestion
    command: python pipeline/automated_pipeline.py
    volumes:
      - ./logs:/app/logs
      - ./clinical_trials.db:/app/clinical_trials.db
      - ./config.json:/app/config.json
    environment:
      - PYTHONPATH=/app

  # ML training service
  ml-training:
    build: .
    container_name: clinical-trial-ml-training
    command: python pipeline/improve_ml_with_real_data.py
    volumes:
      - ./logs:/app/logs
      - ./clinical_trials.db:/app/clinical_trials.db
      - ./config.json:/app/config.json
    environment:
      - PYTHONPATH=/app